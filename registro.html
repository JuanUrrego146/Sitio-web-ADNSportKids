<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ADN Sport Kids - Login / Registro</title>
  <link rel="stylesheet" href="css/stylesRegistro.css">
</head>
<body>
  <div class="container">

    <div class="logo">
      <img src="Imagenes/logo.png" alt="ADN Sport Kids Logo" />
    </div>

    <!-- FORMULARIO DE LOGIN -->
    <div class="form-container" id="loginForm">
      <h2>INICIA SESIÓN EN ADN SPORT KIDS</h2>

      <label for="email">CORREO ELECTRÓNICO*</label>
      <input type="email" id="email" placeholder="INGRESE AQUÍ*" />

      <label for="password">CONTRASEÑA*</label>
      <input type="password" id="password" placeholder="INGRESE AQUÍ*" />

      <button class="btn" id="loginBtn">INICIAR SESIÓN</button>

      <hr />

      <p>¿ES TU PRIMERA VEZ AQUÍ?</p>
      <button class="btn-secondary" id="goRegister">REGÍSTRATE</button>
    </div>

    <!-- FORMULARIO DE REGISTRO -->
  <div class="form-container hidden" id="registerForm">
    <h2>REGÍSTRATE EN ADN SPORT KIDS</h2>

    <label for="username">NOMBRE DE USUARIO*</label>
    <input type="text" id="username" placeholder="INGRESE AQUÍ*" />

    <label for="emailRegister">CORREO ELECTRÓNICO*</label>
    <input type="email" id="emailRegister" placeholder="INGRESE AQUÍ*" />

    <label for="passwordRegister">CONTRASEÑA*</label>
    <input type="password" id="passwordRegister" placeholder="INGRESE AQUÍ*" />

    <!-- NUEVA DIRECCIÓN DE ENVÍO -->
    <label for="addressRegister">DIRECCIÓN DE ENVÍO*</label>
    <input type="text" id="addressRegister" placeholder="CALLE, NÚMERO, COLONIA..." />

    
    <!-- NUEVO: NÚMERO DE CELULAR -->
    <label for="phoneRegister">NÚMERO DE CELULAR*</label>
    <input type="text" id="phoneRegister" placeholder="EJ: 300-123-4567" maxlength="12" />

    <!-- NUEVO: CIUDAD -->
    <label for="cityRegister">CIUDAD DONDE VIVES*</label>
    <input type="text" id="cityRegister" placeholder="INGRESE SU CIUDAD" />

    <button class="btn" id="createAccount">CREAR CUENTA</button>

    <hr />

    <p>¿YA TIENES CUENTA?</p>
    <button class="btn-secondary" id="goLogin">INICIA SESIÓN</button>
  </div>


  </div>

  <script>
    // Referencias a los formularios
    const loginForm = document.getElementById('loginForm');
    const registerForm = document.getElementById('registerForm');
    const goRegister = document.getElementById('goRegister');
    const goLogin = document.getElementById('goLogin');
    const loginBtn = document.getElementById('loginBtn');
    const createAccount = document.getElementById('createAccount');
    const phoneInput = document.getElementById("phoneRegister");

    // Cambiar entre login y registro
    goRegister.addEventListener('click', () => {
      loginForm.classList.add('hidden');
      registerForm.classList.remove('hidden');
    });

    goLogin.addEventListener('click', () => {
      registerForm.classList.add('hidden');
      loginForm.classList.remove('hidden');
    });

    
  phoneInput.addEventListener("input", () => {
    let value = phoneInput.value.replace(/\D/g, ""); // quitar todo lo que no sea número

    if (value.length > 3 && value.length <= 6) {
      value = value.replace(/(\d{3})(\d+)/, "$1-$2");
    } else if (value.length > 6) {
      value = value.replace(/(\d{3})(\d{3})(\d+)/, "$1-$2-$3");
    }

    phoneInput.value = value.slice(0, 12); // limitar a XXX-XXX-XXXX
  });

    // Redirección al presionar "Crear cuenta"

  createAccount.addEventListener('click', () => {
    const username = document.getElementById('username').value.trim();
    const email = document.getElementById('emailRegister').value.trim();
    const password = document.getElementById('passwordRegister').value.trim();
    const address = document.getElementById('addressRegister').value.trim();
    const phone = document.getElementById('phoneRegister').value.trim();
    const city = document.getElementById('cityRegister').value.trim();

    if (!username || !email || !password || !address || !phone || !city) {
      alert("Por favor, completa todos los campos.");
      return;
    }

    const normalizePhone = (value) => {
      const digits = value.replace(/\D/g, '').slice(-10);
      if (!digits) return '';
      const formatted = digits.replace(/(\d{3})(\d{3})(\d{4})/, '$1-$2-$3');
      return `+57 ${formatted}`;
    };

    const newUser = {
      username,
      email,
      password,
      address,
      phone: normalizePhone(phone),
      city
    };

    // Obtener JSON existente o crear uno nuevo
    let usersJSON = localStorage.getItem("usuarios");

    if (usersJSON) {
      usersJSON = JSON.parse(usersJSON);
    } else {
      usersJSON = { users: [] };
    }

    // Agregar el nuevo usuario
    usersJSON.users.push(newUser);

    // Guardar en localStorage
    localStorage.setItem("usuarios", JSON.stringify(usersJSON));

    // Guardar usuario actual
    localStorage.setItem("usuario_actual", JSON.stringify(newUser));

    alert("Cuenta creada correctamente ✔️");

    window.location.href = 'index.html';
  });


    loginBtn.addEventListener('click', () => {
      const email = document.getElementById('email').value.trim();
      const password = document.getElementById('password').value.trim();

      if (!email || !password) {
        alert("Por favor completa todos los campos.");
        return;
      }
      
      // Acceso directo al panel de administración
      if (email.toLowerCase() === 'admin' && password === 'admin') {
        window.location.href = 'admin.html';
        return;
      }

      // Obtener usuarios del LocalStorage
      const usersJSON = JSON.parse(localStorage.getItem("usuarios"));

      if (!usersJSON) {
        alert("No hay usuarios registrados.");
        return;
      }

      // Buscar coincidencia
      const usuarioEncontrado = usersJSON.users.find(user => 
        user.email === email && user.password === password
      );

      if (!usuarioEncontrado) {
        alert("Correo o contraseña incorrectos.");
        return;
      }

      if (usuarioEncontrado.estado === 'baneado') {
        alert("Esta cuenta está baneada. Contacta con soporte si crees que es un error.");
        return;
      }

      // Guardar usuario actual para usar en otras páginas
      localStorage.setItem("usuario_actual", JSON.stringify(usuarioEncontrado));

      // Registrar inicio de sesión en el historial local
      const historial = JSON.parse(localStorage.getItem("historial_logins") || "[]");
      historial.unshift({
        email: usuarioEncontrado.email,
        username: usuarioEncontrado.username,
        fecha: new Date().toISOString()
      });
      localStorage.setItem("historial_logins", JSON.stringify(historial.slice(0, 200)));

      alert("Inicio de sesión exitoso.");
      window.location.href = "index.html";
    });


  </script>
</body>
</html>
